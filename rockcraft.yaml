name: sdcore-gui
base: ubuntu:22.04
version: "0.1"
summary: SD-Core GUI
description: |
  A graphical user interface for SD-Core.
license: Apache-2.0
platforms:
  amd64:

services:
  sdcore-gui:
    override: replace
    command: npm run start
    working-dir: /app
    startup: enabled
    environment:
      WEBUI_ENDPOINT: "http://1.3.4.5:5000"
      UPF_HOSTNAME: "upf"
      UPF_PORT: 1111

parts:
  node:  # FIXME: Node should be installed using `stage-snap`. Bug: https://github.com/canonical/rockcraft/issues/307
    plugin: nil
    override-build: |
      curl -s "https://nodejs.org/dist/v18.16.1/node-v18.16.1-linux-x64.tar.gz" | tar --strip-components=1 -xzf - -C "${CRAFT_PART_INSTALL}"

  frontend:
    plugin: nil
    source: .
    build-snaps:
      - node/18/stable
    override-build: |
      mkdir -p ${CRAFT_PART_INSTALL}/app
      
      npm ci
      npm run build
      
      cp -r .next ${CRAFT_PART_INSTALL}/app/
      cp -r node_modules ${CRAFT_PART_INSTALL}/app/
      cp package*.json ${CRAFT_PART_INSTALL}/app/
      cp -r public ${CRAFT_PART_INSTALL}/app/
      cp -r config ${CRAFT_PART_INSTALL}/app/
